{#
  This is the TWIG file for the creation of an PatientEPS
  It creates a FSH part including the HTML part in text.div from the |%%FSH%% tag on
  The HTML part is created by amalgamating the HTML strings to the final one
  It creates the HTML part as well and includes that below after the |%%HTML%% tag
  The two tagged parts are post-processed by the SYNDERAI script

  KH since 2025-09-07
#}

%%FSH%% {# tag required #}
Instance: {{ setInstance("Instance-Patient-" ~ patient.instanceid) }}
InstanceOf: PatientEuEps
Title: "Patient (EPS)"
Description: "Patient"
Usage: #inline

* id = "{{ patient.instanceid }}"

{{ addHTML_tr() }}


{# 
  emit data of the identifiers
#}

* identifier[+].type = $v2-0203#JHN
* identifier[=].system = "http://ec.europa.eu/identifier/eci"
* identifier[=].value = "{{ patient.eci }}"

* identifier[+].type = $v2-0203#JHN
* identifier[=].system = "http://local.setting.eu/identifier"
* identifier[=].value = "{{ patient.match }}"

{# *** HTML td 1: name #}
* name[+].family = "{{ patient.family }}"
* name[+].given = "{{ patient.given }}"
* name[+].text = "{{ patient.given ~ " " ~ patient.family }}"
{{ addHTML_td(patient.given ~ " " ~ patient.family) }}

{# *** HTML td 2: gender #}
* gender = #{{ patient.gender }}
{{ addHTML_td(patient.gender) }}

{# *** HTML td 3: birthdate #}
* birthDate = "{{patient.birthdate }}"
{{ addHTML_td(patient.birthdate) }}

* address[+].use = #home
* address[=].type = #physical
* address[=].line[+] = "{{ patient.street }}"
* address[=].city = "{{ patient.city }}"
* address[=].postalCode = "{{ patient.postcode }}"
* address[=].country = "{{ patient.countryname }}"

* telecom[+].system = #phone
* telecom[=].value = "{{ patient.phone }}"

{{ addHTML_trend() -}}

{# populate .text #}
* text.status = #generated
* text.div ="""
<div xmlns="http://www.w3.org/1999/xhtml"
<table class="hl7__ips">{{ emitHTML() | raw }}</table>
</div>
"""

%%HEAD%% {# tag required, content below maybe emtpy #}
<!-- empty -->

%%HTML%% {# tag required, content below maybe emtpy #}
{{ emitHTML() | raw }}